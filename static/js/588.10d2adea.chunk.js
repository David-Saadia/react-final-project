"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[588],{3507:(e,s,t)=>{t.d(s,{N:()=>i});var a=t(5043),o=t(6088),n=t(3216),l=t(579);function i(){const{user:e,loading:s}=(0,a.useContext)(o.t),[t,i]=(0,a.useState)(!1),r=(0,n.Zp)();(0,a.useEffect)((()=>{if(s)return(0,l.jsx)("div",{children:"Loading..."});e&&i(!0),t||s||console.log("User is not authenticated, redirecting..."),s||e||function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.startTransition)((()=>{r(e,s)}))}("/")}),[e,s,r,t])}},5588:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var a=t(5043),o=t(6088),n=t(3507),l=t(5799),i=t(4737),r=t(3944),c=t(4185),d=t(5566),u=t(8351),g=t(9099),m=t(5553),v=t(4518),p=t(9667),h=t(3216),j=t(579);function x(e){const{user:s,fetchUserPFP:t}=(0,a.useContext)(o.t),{creator:n,groupID:r,chatID:c}=e,[d,u]=(0,a.useState)(e.groupName),[g,x]=(0,a.useState)(""),[f,b]=(0,a.useState)(e.members),[y,w]=(0,a.useState)([]),[I,N]=(0,a.useState)([]),[A,C]=(0,a.useState)(e.admins),[$,k]=(0,a.useState)(!1),[S,R]=(0,a.useState)(null),q=(0,h.Zp)(),D=e=>{(0,a.startTransition)((()=>{q(e)}))};(0,a.useEffect)((()=>{(async()=>{const s=e.groupImage?e.groupImage:await(0,i.rb)(n);if("string"===typeof s&&s.includes("static"))x(s);else{const e=await t(s._id,!1);console.log(`groupImage: ${s}`),console.log(`fetchedAvatar: ${e}`),e&&x(e)}})(),async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&f){const e=await Promise.all(f.map((async e=>{const s=await(0,i.rb)(e);if(s.includes("static"))return s;{const e=await t(s,!1);if(e)return e}})));w(e)}}(),async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&f){const e=await Promise.all(f.map((async e=>({username:await(0,i.qY)(e),uid:e}))));N(e)}}()}),[e.groupImage,n,f,t]),(0,a.useEffect)((()=>{(async()=>{if(!e.joinRequests||0===e.joinRequests.length)return;const s=await Promise.all(e.joinRequests.map((async e=>{if("string"!==typeof e)return;const s=await(0,i.qY)(e),t=await(0,i.rb)(e);return s&&t?{username:s,uid:e,avatar:t}:(console.log("possible undefined hit"),null)})));R(s.filter(Boolean))})()}),[e.joinRequests]);const E=()=>f&&f.includes(s.uid),P=async()=>{try{const s=await l.A.delete(`/groups/${r}`);200===s.status&&(console.log(s.data.message),alert(s.data.message),e.onDelete())}catch(a){var s,t;console.log(a),console.log(null===(s=a.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)}},_=e=>{b(e)};return(0,j.jsxs)("div",{id:"group-card",children:[(0,j.jsxs)("div",{id:"group-card-header",children:[(0,j.jsxs)("div",{className:"grouped",children:[(0,j.jsx)("img",{className:"group-image",src:g,alt:"groupImage"}),(0,j.jsx)(v.A,{title:d})]}),E()&&(0,j.jsx)("button",{onClick:async()=>{try{if(n===s.uid)return void P();const a=await l.A.delete(`/groups/leave/${s.uid}?groupId=${r}`);var e,t;if(200===a.status)console.log(a.data.message),alert(a.data.message),b(null===(e=a.data)||void 0===e||null===(t=e.group)||void 0===t?void 0:t.members)}catch(i){var a,o;console.log(i),console.log(null===(a=i.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)}},children:"Leave"})]}),(0,j.jsx)("ul",{className:"card-carousel",children:y&&y.map(((e,s)=>s<5?(0,j.jsx)("li",{className:"card-carousel-item",children:(0,j.jsx)("img",{className:"group-member-avatar",src:e,alt:"usersAvatar"})},s):null))}),(0,j.jsx)("div",{id:"group-card-footer",children:E()?(0,j.jsxs)("div",{children:[(0,j.jsx)("button",{onClick:e=>D(`/groups/feed/${r}`),children:"Explore"}),(0,j.jsx)("button",{onClick:e=>D(`/chat/${c}`),children:"Chat"}),A&&A.includes(s.uid)&&(0,j.jsxs)("div",{className:"grouped",children:[(0,j.jsx)("button",{onClick:()=>{k(!0)},children:"Manage"}),(0,j.jsx)("button",{onClick:P,children:"Delete"})]})]}):(0,j.jsx)("button",{onClick:async()=>{try{const e={groupId:r},t=await l.A.post(`/groups/join/${s.uid}`,e);200===t.status&&(console.log(t.data.message),alert(t.data.message))}catch(a){var e,t;console.log(a),console.log(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)}},children:"Join"})}),(0,j.jsx)(m.Ay,{isOpen:$,onClose:()=>{k(!1)},styleId:"invite-modal",children:(0,j.jsx)(p.A,{tabs:["New Name","Members","Invite","New Image"],tabsContent:[(0,j.jsx)(m.a3,{groupName:d,onRenameGroup:e=>(async e=>{try{console.log(`New group name: ${e}`);const t=await l.A.put(`/groups/${r}`,{name:e,admin:s.uid});200===t.status&&(console.log(t.data.message),alert(t.data.message),u(e))}catch(o){var t,a;console.log(o),console.log(null===(t=o.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)}})(e),joinRequests:S,onAcceptInvite:async e=>{try{console.log(`Accepting ${e} to group:${r}`);const n={groupId:r},i=await l.A.put(`/groups/accept/${e}`,n);var s,t,a,o;if(200===i.status)console.log(i.data.message),alert(i.data.message),b(null===(s=i.data)||void 0===s||null===(t=s.group)||void 0===t?void 0:t.members),R(null===(a=i.data)||void 0===a||null===(o=a.group)||void 0===o?void 0:o.joinRequests)}catch(c){var n,i;console.log(c),console.log(null===(n=c.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)}},onDeclineInvite:async e=>{try{console.log(`Rejecting ${e}`);const n={groupId:r},i=await l.A.put(`/groups/decline/${e}`,n);var s,t,a,o;if(200===i.status)console.log(i.data.message),alert(i.data.message),b(null===(s=i.data)||void 0===s||null===(t=s.group)||void 0===t?void 0:t.members),R(null===(a=i.data)||void 0===a||null===(o=a.group)||void 0===o?void 0:o.joinRequests)}catch(c){var n,i;console.log(c),console.log(null===(n=c.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)}}}),(0,j.jsx)(m.wP,{self:s.uid,members:I,membersAvatars:y,admins:A,removeMember:async e=>{try{console.log(`Kicking ${e} by admin:${s.uid}`);const i=await l.A.delete(`/groups/kick/${e}?groupId=${r}`);var t,a,o,n;if(200===i.status)console.log(null===(t=i.data)||void 0===t?void 0:t.message),alert(null===(a=i.data)||void 0===a?void 0:a.message),b(null===(o=i.data)||void 0===o||null===(n=o.group)||void 0===n?void 0:n.members)}catch(d){var i,c;console.log(d),console.log(null===(i=d.response)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.message)}},onPromote:async e=>{try{console.log(`Promoting ${e} in group:${r}`);const n={groupId:r},i=await l.A.put(`/groups/promote/${e}`,n);var s,t,a,o;if(200===i.status)console.log(i.data.message),alert(i.data.message),b(null===(s=i.data)||void 0===s||null===(t=s.group)||void 0===t?void 0:t.members),C(null===(a=i.data)||void 0===a||null===(o=a.group)||void 0===o?void 0:o.admins)}catch(c){var n,i;console.log(c),console.log(null===(n=c.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)}}}),(0,j.jsx)(m.OI,{onInviteFriend:(s,t)=>e.onInvite(s,t,r,_)}),(0,j.jsx)(m.hQ,{groupId:r})],tabStyleId:"manage-group-tabs"})})]})}var f=t(6139);function b(e){const{user:s,loading:t}=(0,a.useContext)(o.t),{results:v}=e;(0,n.N)();const[p,h]=(0,a.useState)([]),[b,y]=(0,a.useState)(""),[w,I]=(0,a.useState)(""),[N,A]=(0,a.useState)(!1);(0,a.useEffect)((()=>{v&&0!==v.length?h(v):(async()=>{try{const e=await l.A.get("/groups/?limit=20");200===e.status&&(console.log(e.data.message),console.log(e.data.groups),h(e.data.groups))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[v]);const C=async()=>{const e={creator:s.uid,name:b};try{const s=await l.A.post("/groups",e),{group:a,message:o}=s.data;var t;if(201===s.status)console.log(o),console.log(a),h((e=>[...e,a])),n=a._id,A(!0),I(n);else console.log(null===(t=s.data)||void 0===t?void 0:t.message)}catch(i){var a,o;console.log(i),console.log(null===(a=i.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)}var n},$=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(""!==w||t)try{console.log(`Inviting ${s}`);const e=await(0,i.fz)(s);if(!e)return alert("User not found.");const o=Object.keys(e)[0];console.log(`DB UserID: ${o}`);const n=t||w;console.log(`groupId: ${n}`);const r={groupId:n},c=await l.A.put(`/groups/invite/${o}`,r);200===c.status&&(console.log(c.data.message),h((e=>e.map((e=>e._id===n?c.data.group:e)))),alert(`Invited ${s} to the group successfully.`),a&&a(c.data.group.members))}catch(g){var o,n,r,c,d,u;console.log(g),console.log(null===(o=g.response)||void 0===o||null===(n=o.data)||void 0===n?void 0:n.message),alert(null===(r=g.response)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.message),console.log(null===(d=g.response)||void 0===d||null===(u=d.data)||void 0===u?void 0:u.error)}};return t?(0,j.jsx)("div",{children:"Loading..."}):(0,j.jsx)(c.A,{title:"Groups",backgroundImage:r,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,j.jsxs)("div",{className:"groups",children:[(0,j.jsx)(d.A,{}),(0,j.jsxs)("div",{className:"page-container",id:"groups-page-container",children:[(0,j.jsx)(u.A,{}),(0,j.jsxs)("div",{id:"group-list-wrapper",children:[(0,j.jsxs)("div",{id:"new-group-form",children:[(0,j.jsx)(g.A,{inputStyle:"new-group-field",type:"text",value:b,onChange:e=>y(e.target.value),prompt:"New group name.."}),(0,j.jsx)("button",{className:"submit-button",id:"create-group-button",onClick:()=>{window.confirm(`Are you sure you want to create the group ${b}?`)&&C()},children:"Create"})]}),(0,j.jsx)("div",{id:"groups-list",children:s&&p.length>0&&p.map((e=>(0,j.jsx)(x,{groupID:e._id,groupImage:e.logo,groupName:e.name,creator:e.creator,creationDate:e.creationDate,members:e.members,admins:e.admins,chatID:e.chatId,joinRequests:e.joinRequests,onDelete:()=>{const s=p.filter((s=>s._id!==e._id));h(s)},onInvite:$},e._id)))})]}),(0,j.jsx)(f.default,{miniView:!0})]}),(0,j.jsx)(m.Ay,{styleId:"invite-popup",onClose:()=>{A(!1)},isOpen:N,children:(0,j.jsx)(m.OI,{onInviteFriend:$})})]})})}},6139:(e,s,t)=>{t.r(s),t.d(s,{default:()=>y});var a=t(5043),o=t(3216),n=t(3507),l=t(3944),i=t(6088),r=t(3829),c=t(4737),d=t(5799),u=t(4518),g=t(579);function m(e){const[s,t]=(0,a.useState)([]),{user:o,loading:n}=(0,a.useContext)(i.t),[l,m]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{const e=await d.A.get(`/chats/?userId=${o.uid}&limit=20`);200===e.status&&m(e.data.chats)}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[o]),(0,a.useEffect)((()=>{!async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&l){const e=await Promise.all(l.map((async e=>{var s;const t=e.isGroupChat?await(0,c.rb)(e.creator):await(0,c.rb)(e.participants.find((e=>e!==(null===o||void 0===o?void 0:o.uid))));let a="N/A";try{if(e.isGroupChat){const s=await d.A.get(`/groups/search/${e.group._id}`);200===s.status&&(a=s.data.group.name)}else a=await(0,c.qY)(e.participants.find((e=>e!==(null===o||void 0===o?void 0:o.uid))))}catch(n){console.log(n)}return(null===(s=a)||void 0===s?void 0:s.length)>10&&(a=a.split(" ").length>1?(0,r.zo)(a).slice(0,3):a.slice(0,7)),{avatar:t,label:a}})));t(e)}}()}),[l,o]);return n?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsx)("div",{className:"docked-container",id:"chat-list-container",children:(0,g.jsx)("ul",{className:"chat-list",children:s.map(((s,t)=>(0,g.jsxs)("li",{onClick:s=>{return a=l[t]._id,console.log("opening chat",a),void e.setChatSelected(a);var a},className:"grouped chat-item",id:"chat-i",children:[(0,g.jsx)("img",{id:"chat-avatar",src:s.avatar,alt:s.label}),(0,g.jsx)(u.A,{title:s.label,designClass:"chat-title"})]},t)))})})}var v=t(2104);function p(e){const[s,t]=(0,a.useState)(""),[o,n]=(0,a.useState)(""),{message:l}=e,{user:d,fetchUserPFP:u}=(0,a.useContext)(i.t);return(0,a.useEffect)((()=>{(async()=>{try{const e=await(0,c.rb)(l.author),s=await(0,c.qY)(l.author);if(e.includes("static"))t(e);else{const s=await u(e,!1);s&&t(s)}n(s)}catch(e){console.log(e)}})()}),[l.author,u]),(0,g.jsx)("li",{className:"message grouped",children:l.author===(null===d||void 0===d?void 0:d.uid)?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"}),(0,g.jsxs)("div",{className:"message-content",children:[(0,g.jsx)("div",{className:"message-time",children:(0,r.kv)(l.timestamp)}),(0,g.jsxs)("div",{className:"chat-bubble",children:[(0,g.jsx)("div",{className:"message-username",children:(0,g.jsx)("strong",{children:o})}),(0,g.jsx)("div",{className:"message-text",children:l.content})]})]})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"message-content",children:[(0,g.jsx)("div",{className:"message-time right",children:(0,r.kv)(l.timestamp)}),(0,g.jsxs)("div",{className:"chat-bubble right",children:[(0,g.jsx)("div",{className:"message-username right",children:(0,g.jsx)("strong",{children:o})}),(0,g.jsx)("div",{className:"message-text right",children:l.content})]})]}),(0,g.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"})]})})}var h=t(9099);function j(e){const s=(0,a.useRef)(null),[t,o]=(0,a.useState)([]),[n,l]=(0,a.useState)(""),{user:r,token:c}=(0,a.useContext)(i.t),u=(0,a.useRef)(null),{chatId:m}=e,[j,x]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{o([]);try{console.log(`Attempting to pull messages for chat ${m}`);const e=await d.A.get(`/chats/${m}`);200===e.status&&(console.log(e.data.message),o(e.data.messages))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[m]),(0,a.useEffect)((()=>{if(!m||!c)return;const e=(0,v.io)("http://localhost:42069");if(s.current=e,null!==e.current)return e.emit("authenticate",c),e.on("authenticated",(s=>{console.log(null===s||void 0===s?void 0:s.message),e.emit("joinChat",m)})),e.on("joinedChat",(e=>{console.log(null===e||void 0===e?void 0:e.message),x(!0)})),e.on("message",(e=>{o((s=>[...s,e]))})),e.on("error",(e=>{console.log(null===e||void 0===e?void 0:e.message)})),()=>{s.current&&(s.current.disconnect(),s.current=null),x(!1),o([])};console.log("socket is null")}),[m,c]),(0,a.useEffect)((()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[t]);const f=async()=>{if(!n.trim()||!j)return console.log("input is empty"),void(j||console.log("not joined"));s.current.emit("message",{author:r.uid,content:n,chat:m}),l("")};return(0,g.jsxs)("div",{className:"chat-room",children:[(0,g.jsx)("ul",{className:"messages",children:t.length>0&&t.map(((e,s)=>(0,g.jsx)(p,{message:e},s)))}),(0,g.jsx)("div",{ref:u}),(0,g.jsxs)("div",{className:"chat-input grouped",children:[(0,g.jsx)(h.A,{value:n,onChange:e=>l(e.target.value),prompt:"Message...",onKeyDown:e=>"Enter"===e.key&&f()}),(0,g.jsx)("button",{onClick:f,children:"Send"})]})]})}var x=t(8351),f=t(5566),b=t(4185);function y(e){let{miniView:s=!1}=e;const{chatId:t}=(0,o.g)(),[i,r]=(0,a.useState)(t||null),c=(0,o.Zp)();(0,n.N)(),(0,a.useEffect)((()=>{t!==i&&r(t)}),[t,i]);const d=e=>{r(e),c(`/chat/${e}`)};return s?(0,g.jsx)(m,{setChatSelected:d}):(0,g.jsx)(b.A,{title:"Chat",backgroundImage:l,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,g.jsxs)("div",{className:"chat",children:[(0,g.jsx)(f.A,{}),(0,g.jsx)(x.A,{}),(0,g.jsxs)("div",{className:"page-container",id:"chat-container",children:[(0,g.jsxs)("div",{className:"grouped",children:[(0,g.jsx)(h.A,{type:"text",prompt:"Search...",styleClass:"search-bar",styleId:"chat-search"}),(0,g.jsx)("button",{children:"Search"})]}),i&&(0,g.jsx)(j,{chatId:i})]}),(0,g.jsx)(m,{setChatSelected:d})]})})}},9667:(e,s,t)=>{t.d(s,{A:()=>n});var a=t(5043),o=t(579);function n(e){var s;const[t,n]=(0,a.useState)(e.tabs[0]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"tabs",children:e.tabs.map(((s,a)=>{var l;return(0,o.jsx)("button",{className:"tab-link "+(t===s?"active":""),id:null!==(l=e.tabStyleId)&&void 0!==l?l:"",onClick:()=>n(s),children:s.charAt(0).toUpperCase()+s.slice(1)},a)}))}),null===(s=e.tabsContent)||void 0===s?void 0:s.map(((s,a)=>(0,o.jsx)("div",{className:"tab-content "+(t===e.tabs[a]?"active":""),id:`tab-${e.tabs[a]}`,children:s},a)))]})}}}]);
//# sourceMappingURL=588.10d2adea.chunk.js.map