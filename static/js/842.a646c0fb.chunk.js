"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[139,842],{2525:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(5043);const n=t.p+"static/media/show-password-icon.c53d4a2c8350a35e0b0a.png",i=t.p+"static/media/hide-password-icon.bc5e1dd54b7c6292a2ea.png";var o=t(579);function l(e){const[s,t]=(0,a.useState)(!1),l="password"===e.type,c=e.value&&e.value.trim().length>0;return(0,o.jsxs)("div",{className:`form-field ${e.styleClass}`,children:[(0,o.jsx)("input",{name:e.type,type:l&&s?"text":e.type,title:e.type,value:e.value,onChange:e.onChange,required:!0}),(0,o.jsx)("span",{className:"popup_text "+(c?"has-content":""),children:e.prompt}),l&&(0,o.jsxs)("span",{onClick:()=>t((e=>!e)),children:[(0,o.jsx)("img",{className:"toggle-password",src:s?i:n,alt:"password toggle"})," "]})]})}},3319:(e,s,t)=>{e.exports=t.p+"static/media/background-postfeed-light.c56a8677a0d2422f1f43.png"},3351:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var a=t(3944),n=t(4185),i=t(5566),o=t(5043),l=t(5799),c=t(3145),r=t(4737),d=t(4518),u=t(9667),g=t(9099),m=t(1631),h=t(2525),v=t(7416),p=t(579);function x(e){const{user:s,avatar:t}=(0,o.useContext)(c.t),[a,n]=(0,o.useState)(null),[i,x]=(0,o.useState)(""),[j,f]=(0,o.useState)(""),[b,N]=(0,o.useState)(""),[y,C]=(0,o.useState)("");(0,o.useEffect)((()=>{(async()=>{try{const e=await(0,r.qY)(s.uid);console.log(`userName: ${e}`),f(e)}catch(e){console.log(e)}})()}),[s]);const w=async(e,t)=>{e.preventDefault(),"primary"===t?(await(async()=>{try{if(null===a)return;const e=new FormData;e.append("image",a),e.append("filePath","/pfps");const t=await l.A.post("/upload/image",e);201===t.status&&(console.log(t.data.message),await(0,r.$2)(`/users/${s.uid}/settings/avatar`,t.data.file._id),alert("Profile picture changed successfully."))}catch(n){var e,t;console.log(n),console.log(null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)}})(),await(async()=>{try{if(""===i)return;await(0,r.$2)(`/users/${s.uid}/settings/username`,i),alert("Username changed successfully."),x(""),f(i)}catch(a){var e,t;console.log(a),console.log(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)}})()):"credentials"===t&&await(async()=>{try{if(""===b||""===y)return;if(b!==y)return alert("Passwords do not match.");await(0,v.f3)(s,b),alert("Password changed successfully."),N(""),C("")}catch(a){var e,t;console.log(a),console.log(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)}})()};return(0,p.jsxs)("div",{className:"center-container  settings-card",children:[(0,p.jsx)(d.A,{designClass:"settings-title",title:"User Settings"}),(0,p.jsxs)("section",{className:"user-primary-info",children:[(0,p.jsx)("img",{className:"settings-avatar",alt:"avatar",src:t}),(0,p.jsx)(d.A,{designClass:"settings-user-name",title:j}),(0,p.jsx)("button",{className:"submit-button change-primary-btn",children:"Change"})]}),(0,p.jsx)("div",{className:"settings-divider"}),(0,p.jsxs)("section",{className:"credentials-change",children:[(0,p.jsx)(d.A,{designClass:"settings-user-name",title:"Change Credentials"}),(0,p.jsx)("button",{className:"submit-button change-credentials-btn",children:"Change"})]}),(0,p.jsx)("div",{className:"settings-divider"}),(0,p.jsx)(u.A,{tabs:["Primary","Credentials"],tabsContent:[(0,p.jsxs)("form",{className:"primary-details-form",children:[(0,p.jsx)(g.A,{type:"text",value:i,onChange:e=>x(e.target.value),prompt:"New Username"}),(0,p.jsx)(m.A,{onSelectImage:e=>n(e)}),(0,p.jsx)("button",{className:"submit-button",onClick:e=>w(e,"primary"),children:"Submit"})]}),(0,p.jsxs)("form",{className:"credentials-form",children:[(0,p.jsx)(h.A,{type:"password",value:b,onChange:e=>N(e.target.value),prompt:"New Password"}),(0,p.jsx)(h.A,{type:"password",value:y,onChange:e=>C(e.target.value),prompt:"Confirm Password"}),(0,p.jsx)("button",{className:"submit-button",onClick:e=>w(e,"credentials"),children:"Submit"})]})]}),(0,p.jsx)("div",{className:"settings-divider"}),(0,p.jsxs)("section",{className:"delete-account",children:[(0,p.jsx)("span",{children:"Delete Account"}),(0,p.jsx)("button",{className:"submit-button delete-btn",children:"Delete"})]})]})}var j=t(8351),f=t(6139);function b(e){return(0,p.jsx)(n.A,{title:"Settings Page",backgroundImage:a,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,p.jsxs)("div",{className:"settings",children:[(0,p.jsx)(i.A,{}),(0,p.jsxs)("div",{className:"page-container",id:"home-container",children:[(0,p.jsx)(j.A,{}),(0,p.jsx)(x,{}),(0,p.jsx)(f.default,{miniView:!0})]})]})})}},3507:(e,s,t)=>{t.d(s,{N:()=>o});var a=t(5043),n=t(3145),i=t(3216);function o(){const{user:e,loading:s}=(0,a.useContext)(n.t),t=(0,i.Zp)(),o=(0,i.zy)();(0,a.useEffect)((()=>{const n=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.startTransition)((()=>{t(e,s)}))};"/"!==o&&("/home"!==o||e||n("/login"),s&&!e&&console.log("User authentication is loading..."),s||e||(console.log("User is not logged in. Redirecting to login page..."),n("/")))}),[e,s,o,t])}},6139:(e,s,t)=>{t.r(s),t.d(s,{default:()=>N});var a=t(5043),n=t(3216),i=t(3507),o=t(3319),l=t(3145),c=t(3829),r=t(4737),d=t(5799),u=t(4518),g=t(579);function m(e){const[s,t]=(0,a.useState)([]),{user:n,loading:i,fetchImage:o}=(0,a.useContext)(l.t),[m,h]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{const e=await d.A.get(`/chats/?userId=${n.uid}&limit=20`);200===e.status&&h(e.data.chats)}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[n]),(0,a.useEffect)((()=>{!async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&m){if(!n)return;const e=await Promise.all(m.map((async e=>{var s,t;let a=e.isGroupChat?await(0,r.rb)(e.creator):await(0,r.rb)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))));if(null!==(s=e.group)&&void 0!==s&&s.logo&&e.isGroupChat){var i;console.log("Attempting to fetch group logo");const s=await o(null===(i=e.group)||void 0===i?void 0:i.logo,!1);s&&(a=s)}else if(!a.includes("static")){const e=await o(a,!1);e&&(a=e)}console.log(a),console.log(e);let l="N/A";try{if(e.isGroupChat){const s=await d.A.get(`/groups/search/${e.group._id}`);200===s.status&&(l=s.data.group.name,console.log(l))}else l=await(0,r.qY)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))))}catch(u){console.log(u)}return(null===(t=l)||void 0===t?void 0:t.length)>10&&(l=l.split(" ").length>1?(0,c.zo)(l).slice(0,3):l.slice(0,7)),{avatar:a,label:l}})));t(e)}}()}),[m,n,o]);return i?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsx)("div",{className:"docked-container",id:"chat-list-container",children:(0,g.jsx)("ul",{className:"chat-list",children:s.map(((s,t)=>(0,g.jsxs)("li",{onClick:s=>{return a=m[t]._id,console.log("opening chat",a),void e.setChatSelected(a);var a},className:"grouped chat-item",id:"chat-i",children:[(0,g.jsx)("img",{id:"chat-avatar",src:s.avatar,alt:s.label}),(0,g.jsx)(u.A,{title:s.label,designClass:"chat-title"})]},t)))})})}var h=t(9723);function v(e){const[s,t]=(0,a.useState)(""),[n,i]=(0,a.useState)(""),{message:o}=e,{user:d,fetchImage:u}=(0,a.useContext)(l.t);return(0,a.useEffect)((()=>{(async()=>{try{const e=await(0,r.rb)(o.author),s=await(0,r.qY)(o.author);if(console.log("avatar from message: ",e),e.includes("static"))t(e);else{const s=await u(e,!1);s&&t(s)}i(s)}catch(e){console.log(e)}})()}),[o.author,u]),(0,g.jsx)("li",{className:"message grouped",children:o.author===(null===d||void 0===d?void 0:d.uid)?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"}),(0,g.jsxs)("div",{className:"message-content",children:[(0,g.jsx)("div",{className:"message-time",children:(0,c.kv)(o.timestamp)}),(0,g.jsxs)("div",{className:"chat-bubble",children:[(0,g.jsx)("div",{className:"message-username",children:(0,g.jsx)("strong",{children:n})}),(0,g.jsx)("div",{className:"message-text",children:o.content})]})]})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"message-content",children:[(0,g.jsx)("div",{className:"message-time right",children:(0,c.kv)(o.timestamp)}),(0,g.jsxs)("div",{className:"chat-bubble right",children:[(0,g.jsx)("div",{className:"message-username right",children:(0,g.jsx)("strong",{children:n})}),(0,g.jsx)("div",{className:"message-text right",children:o.content})]})]}),(0,g.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"})]})})}var p=t(9099);function x(e){const s=(0,a.useRef)(null),[t,n]=(0,a.useState)([]),[i,o]=(0,a.useState)(""),{user:c,token:r}=(0,a.useContext)(l.t),u=(0,a.useRef)(null),{chatId:m}=e,[x,j]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{n([]);try{console.log(`Attempting to pull messages for chat ${m}`);const e=await d.A.get(`/chats/${m}`);200===e.status&&(console.log(e.data.message),n(e.data.messages))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[m]),(0,a.useEffect)((()=>{if(!m||!r)return;const e=(0,h.io)("http://localhost:42069");if(s.current=e,null!==e.current)return e.emit("authenticate",r),e.on("authenticated",(s=>{console.log(null===s||void 0===s?void 0:s.message),e.emit("joinChat",m)})),e.on("joinedChat",(e=>{console.log(null===e||void 0===e?void 0:e.message),j(!0)})),e.on("message",(e=>{n((s=>[...s,e]))})),e.on("error",(e=>{console.log(null===e||void 0===e?void 0:e.message)})),()=>{s.current&&(s.current.disconnect(),s.current=null),j(!1),n([])};console.log("socket is null")}),[m,r]),(0,a.useEffect)((()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[t]);const f=async()=>{if(!i.trim()||!x)return console.log("input is empty"),void(x||console.log("not joined"));s.current.emit("message",{author:c.uid,content:i,chat:m}),o("")};return(0,g.jsxs)("div",{className:"chat-room",children:[(0,g.jsx)("ul",{className:"messages",children:t.length>0&&t.map(((e,s)=>(0,g.jsx)(v,{message:e},s)))}),(0,g.jsx)("div",{ref:u}),(0,g.jsxs)("div",{className:"chat-input grouped",children:[(0,g.jsx)(p.A,{value:i,onChange:e=>o(e.target.value),prompt:"Message...",onKeyDown:e=>"Enter"===e.key&&f()}),(0,g.jsx)("button",{onClick:f,children:"Send"})]})]})}var j=t(8351),f=t(5566),b=t(4185);function N(e){let{miniView:s=!1}=e;const{chatId:t}=(0,n.g)(),[l,c]=(0,a.useState)(t||null),r=(0,n.Zp)();(0,i.N)(),(0,a.useEffect)((()=>{t!==l&&c(t)}),[t,l]);const d=e=>{c(e),r(`/chat/${e}`)};return s?(0,g.jsx)(m,{setChatSelected:d}):(0,g.jsx)(b.A,{title:"Chat",backgroundImage:o,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,g.jsxs)("div",{className:"chat",children:[(0,g.jsx)(f.A,{}),(0,g.jsx)(j.A,{}),(0,g.jsxs)("div",{className:"page-container",id:"chat-container",children:[(0,g.jsxs)("div",{className:"grouped",children:[(0,g.jsx)(p.A,{type:"text",prompt:"Search...",styleClass:"search-bar",styleId:"chat-search"}),(0,g.jsx)("button",{children:"Search"})]}),l&&(0,g.jsx)(x,{chatId:l})]}),(0,g.jsx)(m,{setChatSelected:d})]})})}},9667:(e,s,t)=>{t.d(s,{A:()=>i});var a=t(5043),n=t(579);function i(e){var s;const[t,i]=(0,a.useState)(e.tabs[0]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"tabs",children:e.tabs.map(((s,a)=>{var o;return(0,n.jsx)("button",{className:"tab-link "+(t===s?"active":""),id:null!==(o=e.tabStyleId)&&void 0!==o?o:"",onClick:()=>i(s),children:s.charAt(0).toUpperCase()+s.slice(1)},a)}))}),null===(s=e.tabsContent)||void 0===s?void 0:s.map(((s,a)=>(0,n.jsx)("div",{className:"tab-content "+(t===e.tabs[a]?"active":""),id:`tab-${e.tabs[a]}`,children:s},a)))]})}}}]);
//# sourceMappingURL=842.a646c0fb.chunk.js.map