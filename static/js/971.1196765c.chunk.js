"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[139,971],{2525:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(5043);const n=s.p+"static/media/show-password-icon.c53d4a2c8350a35e0b0a.png",o=s.p+"static/media/hide-password-icon.bc5e1dd54b7c6292a2ea.png";var i=s(579);function c(e){const[t,s]=(0,a.useState)(!1),c="password"===e.type,l=e.value&&e.value.trim().length>0;return(0,i.jsxs)("div",{className:`form-field ${e.styleClass}`,children:[(0,i.jsx)("input",{name:e.type,type:c&&t?"text":e.type,title:e.type,value:e.value,onChange:e.onChange,required:!0}),(0,i.jsx)("span",{className:"popup_text "+(l?"has-content":""),children:e.prompt}),c&&(0,i.jsxs)("span",{onClick:()=>s((e=>!e)),children:[(0,i.jsx)("img",{className:"toggle-password",src:t?o:n,alt:"password toggle"})," "]})]})}},3319:(e,t,s)=>{e.exports=s.p+"static/media/background-postfeed-light.c56a8677a0d2422f1f43.png"},3507:(e,t,s)=>{s.d(t,{N:()=>i});var a=s(5043),n=s(3145),o=s(3216);function i(){const{user:e,loading:t}=(0,a.useContext)(n.t),s=(0,o.Zp)(),i=(0,o.zy)();(0,a.useEffect)((()=>{const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.startTransition)((()=>{s(e,t)}))};"/"!==i&&("/home"!==i||e||n("/login"),t&&!e&&console.log("User authentication is loading..."),t||e||(console.log("User is not logged in. Redirecting to login page..."),n("/")))}),[e,t,i,s])}},6139:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var a=s(5043),n=s(3216),o=s(3507),i=s(3319),c=s(3145),l=s(3829),r=s(4737),d=s(5799),u=s(4518),g=s(579);function h(e){const[t,s]=(0,a.useState)([]),{user:n,loading:o,fetchImage:i}=(0,a.useContext)(c.t),[h,m]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{const e=await d.A.get(`/chats/?userId=${n.uid}&limit=20`);200===e.status&&m(e.data.chats)}catch(s){var e,t;console.log(s),console.log(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)}})()}),[n]),(0,a.useEffect)((()=>{!async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&h){if(!n)return;const e=await Promise.all(h.map((async e=>{var t,s;let a=e.isGroupChat?await(0,r.rb)(e.creator):await(0,r.rb)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))));if(null!==(t=e.group)&&void 0!==t&&t.logo&&e.isGroupChat){var o;console.log("Attempting to fetch group logo");const t=await i(null===(o=e.group)||void 0===o?void 0:o.logo,!1);t&&(a=t)}else if(!a.includes("static")){const e=await i(a,!1);e&&(a=e)}console.log(a),console.log(e);let c="N/A";try{if(e.isGroupChat){const t=await d.A.get(`/groups/search/${e.group._id}`);200===t.status&&(c=t.data.group.name,console.log(c))}else c=await(0,r.qY)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))))}catch(u){console.log(u)}return(null===(s=c)||void 0===s?void 0:s.length)>10&&(c=c.split(" ").length>1?(0,l.zo)(c).slice(0,3):c.slice(0,7)),{avatar:a,label:c}})));s(e)}}()}),[h,n,i]);return o?(0,g.jsx)("div",{children:"Loading..."}):(0,g.jsx)("div",{className:"docked-container",id:"chat-list-container",children:(0,g.jsx)("ul",{className:"chat-list",children:t.map(((t,s)=>(0,g.jsxs)("li",{onClick:t=>{return a=h[s]._id,console.log("opening chat",a),void e.setChatSelected(a);var a},className:"grouped chat-item",id:"chat-i",children:[(0,g.jsx)("img",{id:"chat-avatar",src:t.avatar,alt:t.label}),(0,g.jsx)(u.A,{title:t.label,designClass:"chat-title"})]},s)))})})}var m=s(9723);function p(e){const[t,s]=(0,a.useState)(""),[n,o]=(0,a.useState)(""),{message:i}=e,{user:d,fetchImage:u}=(0,a.useContext)(c.t);return(0,a.useEffect)((()=>{(async()=>{try{const e=await(0,r.rb)(i.author),t=await(0,r.qY)(i.author);if(console.log("avatar from message: ",e),e.includes("static"))s(e);else{const t=await u(e,!1);t&&s(t)}o(t)}catch(e){console.log(e)}})()}),[i.author,u]),(0,g.jsx)("li",{className:"message grouped",children:i.author===(null===d||void 0===d?void 0:d.uid)?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("img",{src:t,alt:"message-avatar",id:"message-avatar"}),(0,g.jsxs)("div",{className:"message-content",children:[(0,g.jsx)("div",{className:"message-time",children:(0,l.kv)(i.timestamp)}),(0,g.jsxs)("div",{className:"chat-bubble",children:[(0,g.jsx)("div",{className:"message-username",children:(0,g.jsx)("strong",{children:n})}),(0,g.jsx)("div",{className:"message-text",children:i.content})]})]})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"message-content",children:[(0,g.jsx)("div",{className:"message-time right",children:(0,l.kv)(i.timestamp)}),(0,g.jsxs)("div",{className:"chat-bubble right",children:[(0,g.jsx)("div",{className:"message-username right",children:(0,g.jsx)("strong",{children:n})}),(0,g.jsx)("div",{className:"message-text right",children:i.content})]})]}),(0,g.jsx)("img",{src:t,alt:"message-avatar",id:"message-avatar"})]})})}var v=s(9099);function x(e){const t=(0,a.useRef)(null),[s,n]=(0,a.useState)([]),[o,i]=(0,a.useState)(""),{user:l,token:r}=(0,a.useContext)(c.t),u=(0,a.useRef)(null),{chatId:h}=e,[x,j]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{n([]);try{console.log(`Attempting to pull messages for chat ${h}`);const e=await d.A.get(`/chats/${h}`);200===e.status&&(console.log(e.data.message),n(e.data.messages))}catch(s){var e,t;console.log(s),console.log(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)}})()}),[h]),(0,a.useEffect)((()=>{if(!h||!r)return;const e=(0,m.io)("http://localhost:42069");if(t.current=e,null!==e.current)return e.emit("authenticate",r),e.on("authenticated",(t=>{console.log(null===t||void 0===t?void 0:t.message),e.emit("joinChat",h)})),e.on("joinedChat",(e=>{console.log(null===e||void 0===e?void 0:e.message),j(!0)})),e.on("message",(e=>{n((t=>[...t,e]))})),e.on("error",(e=>{console.log(null===e||void 0===e?void 0:e.message)})),()=>{t.current&&(t.current.disconnect(),t.current=null),j(!1),n([])};console.log("socket is null")}),[h,r]),(0,a.useEffect)((()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[s]);const f=async()=>{if(!o.trim()||!x)return console.log("input is empty"),void(x||console.log("not joined"));t.current.emit("message",{author:l.uid,content:o,chat:h}),i("")};return(0,g.jsxs)("div",{className:"chat-room",children:[(0,g.jsx)("ul",{className:"messages",children:s.length>0&&s.map(((e,t)=>(0,g.jsx)(p,{message:e},t)))}),(0,g.jsx)("div",{ref:u}),(0,g.jsxs)("div",{className:"chat-input grouped",children:[(0,g.jsx)(v.A,{value:o,onChange:e=>i(e.target.value),prompt:"Message...",onKeyDown:e=>"Enter"===e.key&&f()}),(0,g.jsx)("button",{onClick:f,children:"Send"})]})]})}var j=s(8351),f=s(5566),b=s(4185);function y(e){let{miniView:t=!1}=e;const{chatId:s}=(0,n.g)(),[c,l]=(0,a.useState)(s||null),r=(0,n.Zp)();(0,o.N)(),(0,a.useEffect)((()=>{s!==c&&l(s)}),[s,c]);const d=e=>{l(e),r(`/chat/${e}`)};return t?(0,g.jsx)(h,{setChatSelected:d}):(0,g.jsx)(b.A,{title:"Chat",backgroundImage:i,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,g.jsxs)("div",{className:"chat",children:[(0,g.jsx)(f.A,{}),(0,g.jsx)(j.A,{}),(0,g.jsxs)("div",{className:"page-container",id:"chat-container",children:[(0,g.jsxs)("div",{className:"grouped",children:[(0,g.jsx)(v.A,{type:"text",prompt:"Search...",styleClass:"search-bar",styleId:"chat-search"}),(0,g.jsx)("button",{children:"Search"})]}),c&&(0,g.jsx)(x,{chatId:c})]}),(0,g.jsx)(h,{setChatSelected:d})]})})}},6787:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(5043),n=s(3145),o=(s(1576),s(3507)),i=s(4185),c=s(3319),l=s(5566),r=s(4409),d=s(8351),u=s(6139),g=s(579);function h(){return(0,o.N)(),(0,g.jsx)(i.A,{title:"Home",backgroundImage:c,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,g.jsxs)("div",{className:"home",children:[(0,g.jsx)(l.A,{}),(0,g.jsxs)("div",{className:"page-container",id:"home-container",children:[(0,g.jsx)(d.A,{}),(0,g.jsx)(r.A,{type:"all"}),(0,g.jsx)(u.default,{miniView:!0})]})]})})}var m=s(3216),p=s(7416),v=s(3936),x=s(4737),j=s(4518),f=s(2525);const b=s.p+"static/media/background-login-light.36daa33feaf57ff13c98.jpg";function y(){const[e,t]=(0,a.useState)(""),[s,o]=(0,a.useState)(""),c=(0,m.Zp)(),{refreshStaleActivityVal:l}=(0,a.useContext)(n.t),r=e=>{(0,a.startTransition)((()=>{c(e)}))};return(0,g.jsx)(i.A,{title:"Login",backgroundImage:b,backgroundPosition:"center",transition:"background-image 0.5s ease-in-out",className:"center-container",children:(0,g.jsxs)("div",{className:"login auth-form-container",children:[(0,g.jsx)(j.A,{title:"Login"}),(0,g.jsx)(f.A,{type:"email",value:e,prompt:"Email",onChange:e=>t(e.target.value)}),(0,g.jsx)(f.A,{type:"password",value:s,prompt:"Password",onChange:e=>o(e.target.value)}),(0,g.jsx)("input",{className:"submit-button",onClick:async t=>{t.preventDefault();try{await(0,p.x9)(v.j,e,s),l.current?l.current():console.log("No refreshStalActiviyFunction found."),(0,x.$O)("/presence/",v.j.currentUser.uid),alert("Signed In Successfully")}catch(a){alert(a.message),console.log(a)}},type:"submit",value:"Sign in"}),(0,g.jsxs)("div",{className:"links-group",children:[(0,g.jsx)("button",{onClick:()=>r("/"),children:"Forgot Password"}),(0,g.jsx)("button",{onClick:()=>r("/signup"),children:"Sign Up"})]})]})})}const N=function(){const{user:e}=(0,a.useContext)(n.t);return(0,g.jsx)("div",{children:e?(0,g.jsx)(h,{}):(0,g.jsx)(y,{})})}}}]);
//# sourceMappingURL=971.1196765c.chunk.js.map