"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[139],{3507:(e,s,t)=>{t.d(s,{N:()=>l});var a=t(5043),n=t(6088),c=t(3216),i=t(579);function l(){const{user:e,loading:s}=(0,a.useContext)(n.t),[t,l]=(0,a.useState)(!1),o=(0,c.Zp)();(0,a.useEffect)((()=>{if(s)return(0,i.jsx)("div",{children:"Loading..."});e&&l(!0),t||s||console.log("User is not authenticated, redirecting..."),s||e||function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.startTransition)((()=>{o(e,s)}))}("/")}),[e,s,o,t])}},6139:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var a=t(5043),n=t(3216),c=t(3507),i=t(3944),l=t(6088),o=t(3829),r=t(4737),d=t(5799),u=t(4518),h=t(579);function g(e){const[s,t]=(0,a.useState)([]),{user:n,loading:c}=(0,a.useContext)(l.t),[i,g]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{const e=await d.A.get(`/chats/?userId=${n.uid}&limit=20`);200===e.status&&g(e.data.chats)}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[n]),(0,a.useEffect)((()=>{!async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&i){const e=await Promise.all(i.map((async e=>{var s;const t=e.isGroupChat?await(0,r.rb)(e.creator):await(0,r.rb)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))));let a="N/A";try{if(e.isGroupChat){const s=await d.A.get(`/groups/search/${e.group._id}`);200===s.status&&(a=s.data.group.name)}else a=await(0,r.qY)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))))}catch(c){console.log(c)}return(null===(s=a)||void 0===s?void 0:s.length)>10&&(a=a.split(" ").length>1?(0,o.zo)(a).slice(0,3):a.slice(0,7)),{avatar:t,label:a}})));t(e)}}()}),[i,n]);return c?(0,h.jsx)("div",{children:"Loading..."}):(0,h.jsx)("div",{className:"docked-container",id:"chat-list-container",children:(0,h.jsx)("ul",{className:"chat-list",children:s.map(((s,t)=>(0,h.jsxs)("li",{onClick:s=>{return a=i[t]._id,console.log("opening chat",a),void e.setChatSelected(a);var a},className:"grouped chat-item",id:"chat-i",children:[(0,h.jsx)("img",{id:"chat-avatar",src:s.avatar,alt:s.label}),(0,h.jsx)(u.A,{title:s.label,designClass:"chat-title"})]},t)))})})}var m=t(2104);function v(e){const[s,t]=(0,a.useState)(""),[n,c]=(0,a.useState)(""),{message:i}=e,{user:d,fetchUserPFP:u}=(0,a.useContext)(l.t);return(0,a.useEffect)((()=>{(async()=>{try{const e=await(0,r.rb)(i.author),s=await(0,r.qY)(i.author);if(e.includes("static"))t(e);else{const s=await u(e,!1);s&&t(s)}c(s)}catch(e){console.log(e)}})()}),[i.author,u]),(0,h.jsx)("li",{className:"message grouped",children:i.author===(null===d||void 0===d?void 0:d.uid)?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"}),(0,h.jsxs)("div",{className:"message-content",children:[(0,h.jsx)("div",{className:"message-time",children:(0,o.kv)(i.timestamp)}),(0,h.jsxs)("div",{className:"chat-bubble",children:[(0,h.jsx)("div",{className:"message-username",children:(0,h.jsx)("strong",{children:n})}),(0,h.jsx)("div",{className:"message-text",children:i.content})]})]})]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"message-content",children:[(0,h.jsx)("div",{className:"message-time right",children:(0,o.kv)(i.timestamp)}),(0,h.jsxs)("div",{className:"chat-bubble right",children:[(0,h.jsx)("div",{className:"message-username right",children:(0,h.jsx)("strong",{children:n})}),(0,h.jsx)("div",{className:"message-text right",children:i.content})]})]}),(0,h.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"})]})})}var x=t(9099);function j(e){const s=(0,a.useRef)(null),[t,n]=(0,a.useState)([]),[c,i]=(0,a.useState)(""),{user:o,token:r}=(0,a.useContext)(l.t),u=(0,a.useRef)(null),{chatId:g}=e,[j,p]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{n([]);try{console.log(`Attempting to pull messages for chat ${g}`);const e=await d.A.get(`/chats/${g}`);200===e.status&&(console.log(e.data.message),n(e.data.messages))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[g]),(0,a.useEffect)((()=>{if(!g||!r)return;const e=(0,m.io)("http://localhost:42069");if(s.current=e,null!==e.current)return e.emit("authenticate",r),e.on("authenticated",(s=>{console.log(null===s||void 0===s?void 0:s.message),e.emit("joinChat",g)})),e.on("joinedChat",(e=>{console.log(null===e||void 0===e?void 0:e.message),p(!0)})),e.on("message",(e=>{n((s=>[...s,e]))})),e.on("error",(e=>{console.log(null===e||void 0===e?void 0:e.message)})),()=>{s.current&&(s.current.disconnect(),s.current=null),p(!1),n([])};console.log("socket is null")}),[g,r]),(0,a.useEffect)((()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[t]);const f=async()=>{if(!c.trim()||!j)return console.log("input is empty"),void(j||console.log("not joined"));s.current.emit("message",{author:o.uid,content:c,chat:g}),i("")};return(0,h.jsxs)("div",{className:"chat-room",children:[(0,h.jsx)("ul",{className:"messages",children:t.length>0&&t.map(((e,s)=>(0,h.jsx)(v,{message:e},s)))}),(0,h.jsx)("div",{ref:u}),(0,h.jsxs)("div",{className:"chat-input grouped",children:[(0,h.jsx)(x.A,{value:c,onChange:e=>i(e.target.value),prompt:"Message...",onKeyDown:e=>"Enter"===e.key&&f()}),(0,h.jsx)("button",{onClick:f,children:"Send"})]})]})}var p=t(8351),f=t(5566),N=t(4185);function b(e){let{miniView:s=!1}=e;const{chatId:t}=(0,n.g)(),[l,o]=(0,a.useState)(t||null),r=(0,n.Zp)();(0,c.N)(),(0,a.useEffect)((()=>{t!==l&&o(t)}),[t,l]);const d=e=>{o(e),r(`/chat/${e}`)};return s?(0,h.jsx)(g,{setChatSelected:d}):(0,h.jsx)(N.A,{title:"Chat",backgroundImage:i,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,h.jsxs)("div",{className:"chat",children:[(0,h.jsx)(f.A,{}),(0,h.jsx)(p.A,{}),(0,h.jsxs)("div",{className:"page-container",id:"chat-container",children:[(0,h.jsxs)("div",{className:"grouped",children:[(0,h.jsx)(x.A,{type:"text",prompt:"Search...",styleClass:"search-bar",styleId:"chat-search"}),(0,h.jsx)("button",{children:"Search"})]}),l&&(0,h.jsx)(j,{chatId:l})]}),(0,h.jsx)(g,{setChatSelected:d})]})})}}}]);
//# sourceMappingURL=139.0ee907bc.chunk.js.map