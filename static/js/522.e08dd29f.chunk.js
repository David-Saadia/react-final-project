"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[522],{6522:(e,o,s)=>{s.r(o),s.d(o,{default:()=>b});var a=s(5043),t=s(3216),n=s(6088),l=s(5799),i=s(4737),r=s(3944),d=s(4185),c=s(7936),u=s(8351),g=s(9099),v=s(5553),p=s(4518),m=s(579);function h(e){var o;const[s,t]=(0,a.useState)(e.tabs[0]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"tabs",children:e.tabs.map(((o,a)=>{var n;return(0,m.jsx)("button",{className:"tab-link "+(s===o?"active":""),id:null!==(n=e.tabStyleId)&&void 0!==n?n:"",onClick:()=>t(o),children:o.charAt(0).toUpperCase()+o.slice(1)},a)}))}),null===(o=e.tabsContent)||void 0===o?void 0:o.map(((o,a)=>(0,m.jsx)("div",{className:"tab-content "+(s===e.tabs[a]?"active":""),id:`tab-${e.tabs[a]}`,children:o},a)))]})}function j(e){const{user:o}=(0,a.useContext)(n.t),{creator:s,creationDate:r,groupID:d,chatID:c}=e,[u,g]=(0,a.useState)(e.groupName),[j,b]=(0,a.useState)(""),[f,x]=(0,a.useState)(e.members),[y,I]=(0,a.useState)([]),[w,$]=(0,a.useState)([]),[A,k]=(0,a.useState)(e.admins),[C,N]=(0,a.useState)(!1),[S,D]=(0,a.useState)(e.joinRequests),_=(0,t.Zp)(),R=e=>{(0,a.startTransition)((()=>{_(e)}))};(0,a.useEffect)((()=>{(async()=>{const o=e.groupImage?e.groupImage:await(0,i.rb)(s);b(o)})(),async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&f){const e=await Promise.all(f.map((async e=>await(0,i.rb)(e))));I(e)}}(),async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&f){const e=await Promise.all(f.map((async e=>({username:await(0,i.qY)(e),uid:e}))));$(e)}}()}),[e.groupImage,s,f]),(0,a.useEffect)((()=>{(async()=>{if(!S||0===S.length)return;const e=await Promise.all(S.map((async e=>{if("string"!==typeof e)return;return{username:await(0,i.qY)(e),uid:e,avatar:await(0,i.rb)(e)}})));D(e)})()}),[S]);const q=()=>f&&f.includes(o.uid),P=async()=>{try{const o=await l.A.delete(`/groups/${d}`);200===o.status&&(console.log(o.data.message),alert(o.data.message),e.onDelete())}catch(a){var o,s;console.log(a),console.log(null===(o=a.response)||void 0===o||null===(s=o.data)||void 0===s?void 0:s.message)}},E=e=>{x(e)};return(0,m.jsxs)("div",{id:"group-card",children:[(0,m.jsxs)("div",{id:"group-card-header",children:[(0,m.jsxs)("div",{className:"grouped",children:[(0,m.jsx)("img",{src:j,alt:"groupImage"}),(0,m.jsx)(p.A,{title:u})]}),q()&&(0,m.jsx)("button",{onClick:async()=>{try{if(s===o.uid)return void P();const t=await l.A.delete(`/groups/leave/${o.uid}?groupId=${d}`);var e,a;if(200===t.status)console.log(t.data.message),alert(t.data.message),x(null===(e=t.data)||void 0===e||null===(a=e.group)||void 0===a?void 0:a.members)}catch(i){var t,n;console.log(i),console.log(null===(t=i.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)}},children:"Leave"})]}),(0,m.jsx)("ul",{className:"card-carousel",children:y&&y.map(((e,o)=>o<5?(0,m.jsx)("li",{className:"card-carousel-item",children:(0,m.jsx)("img",{src:e,alt:"usersAvatar"})},o):null))}),(0,m.jsx)("div",{id:"group-card-footer",children:q()?(0,m.jsxs)("div",{children:[(0,m.jsx)("button",{onClick:e=>R(`/groups/feed/${d}`),children:"Explore"}),(0,m.jsx)("button",{onClick:e=>R(`/chat/${c}`),children:"Chat"}),A&&A.includes(o.uid)&&(0,m.jsxs)("div",{className:"grouped",children:[(0,m.jsx)("button",{onClick:()=>{N(!0)},children:"Manage"}),(0,m.jsx)("button",{onClick:P,children:"Delete"})]})]}):(0,m.jsx)("button",{onClick:async()=>{try{const e={groupId:d},s=await l.A.post(`/groups/join/${o.uid}`,e);200===s.status&&(console.log(s.data.message),alert(s.data.message))}catch(a){var e,s;console.log(a),console.log(null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}},children:"Join"})}),(0,m.jsx)(v.Ay,{isOpen:C,onClose:()=>{N(!1)},styleId:"invite-modal",children:(0,m.jsx)(h,{tabs:["New Name","Members","Invite"],tabsContent:[(0,m.jsx)(v.a3,{groupName:u,onRenameGroup:e=>(async e=>{try{console.log(`New group name: ${e}`);const s=await l.A.put(`/groups/${d}`,{name:e,admin:o.uid});200===s.status&&(console.log(s.data.message),alert(s.data.message),g(e))}catch(t){var s,a;console.log(t),console.log(null===(s=t.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)}})(e),joinRequests:S,onAcceptInvite:async e=>{try{console.log(`Accepting ${e} to group:${d}`);const n={groupId:d},i=await l.A.put(`/groups/accept/${e}`,n);var o,s,a,t;if(200===i.status)console.log(i.data.message),alert(i.data.message),x(null===(o=i.data)||void 0===o||null===(s=o.group)||void 0===s?void 0:s.members),D(null===(a=i.data)||void 0===a||null===(t=a.group)||void 0===t?void 0:t.joinRequests)}catch(r){var n,i;console.log(r),console.log(null===(n=r.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)}},onDeclineInvite:async e=>{try{console.log(`Rejecting ${e}`);const n={groupId:d},i=await l.A.put(`/groups/decline/${e}`,n);var o,s,a,t;if(200===i.status)console.log(i.data.message),alert(i.data.message),x(null===(o=i.data)||void 0===o||null===(s=o.group)||void 0===s?void 0:s.members),D(null===(a=i.data)||void 0===a||null===(t=a.group)||void 0===t?void 0:t.joinRequests)}catch(r){var n,i;console.log(r),console.log(null===(n=r.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)}}}),(0,m.jsx)(v.wP,{self:o.uid,members:w,membersAvatars:y,admins:A,removeMember:async e=>{try{console.log(`Kicking ${e} by admin:${o.uid}`);const i=await l.A.delete(`/groups/kick/${e}?groupId=${d}`);var s,a,t,n;if(200===i.status)console.log(null===(s=i.data)||void 0===s?void 0:s.message),alert(null===(a=i.data)||void 0===a?void 0:a.message),x(null===(t=i.data)||void 0===t||null===(n=t.group)||void 0===n?void 0:n.members)}catch(c){var i,r;console.log(c),console.log(null===(i=c.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)}},onPromote:async e=>{try{console.log(`Promoting ${e} in group:${d}`);const n={groupId:d},i=await l.A.put(`/groups/promote/${e}`,n);var o,s,a,t;if(200===i.status)console.log(i.data.message),alert(i.data.message),x(null===(o=i.data)||void 0===o||null===(s=o.group)||void 0===s?void 0:s.members),k(null===(a=i.data)||void 0===a||null===(t=a.group)||void 0===t?void 0:t.admins)}catch(r){var n,i;console.log(r),console.log(null===(n=r.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)}}}),(0,m.jsx)(v.OI,{onInviteFriend:(o,s)=>e.onInvite(o,s,d,E)})],tabStyleId:"manage-group-tabs"})})]})}function b(){const{user:e,loading:o}=(0,a.useContext)(n.t),s=(0,t.Zp)();(0,a.useEffect)((()=>{e||s("/")}),[e,s]);const[p,h]=(0,a.useState)([]),[b,f]=(0,a.useState)(""),[x,y]=(0,a.useState)(""),[I,w]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{try{const e=await l.A.get("/groups");200===e.status&&(console.log(e.data.message),console.log(e.data.groups),h(e.data.groups))}catch(s){var e,o;console.log(s),console.log(null===(e=s.response)||void 0===e||null===(o=e.data)||void 0===o?void 0:o.message)}})()}),[]);const $=async()=>{const o={creator:e.uid,name:b};try{const e=await l.A.post("/groups",o),{group:a,message:t}=e.data;var s;if(201===e.status)console.log(t),console.log(a),h((e=>[...e,a])),n=a._id,w(!0),y(n);else console.log(null===(s=e.data)||void 0===s?void 0:s.message)}catch(i){var a,t;console.log(i),console.log(null===(a=i.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)}var n},A=async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(""!==x||s)try{console.log(`Inviting ${o}`);const e=await(0,i.fz)(o);if(!e)return alert("User not found.");const t=Object.keys(e)[0];console.log(`DB UserID: ${t}`);const n=s||x;console.log(`groupId: ${n}`);const r={groupId:n},d=await l.A.put(`/groups/invite/${t}`,r);200===d.status&&(console.log(d.data.message),h((e=>e.map((e=>e._id===n?d.data.group:e)))),alert(`Invited ${o} to the group successfully.`),a&&a(d.data.group.members))}catch(g){var t,n,r,d,c,u;console.log(g),console.log(null===(t=g.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message),alert(null===(r=g.response)||void 0===r||null===(d=r.data)||void 0===d?void 0:d.message),console.log(null===(c=g.response)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.error)}};return o?(0,m.jsx)("div",{children:"Loading..."}):(0,m.jsx)(d.A,{title:"Groups",backgroundImage:r,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,m.jsxs)("div",{className:"groups",children:[(0,m.jsx)(c.A,{}),(0,m.jsxs)("div",{className:"page-container",children:[(0,m.jsx)(u.A,{}),(0,m.jsxs)("div",{id:"group-feed-wrapper",children:[(0,m.jsxs)("div",{id:"new-group-form",children:[(0,m.jsx)(g.A,{inputStyle:"new-group-field",type:"text",value:b,onChange:e=>f(e.target.value),prompt:"New group name.."}),(0,m.jsx)("button",{className:"submit-button",id:"create-group-button",onClick:()=>{window.confirm(`Are you sure you want to create the group ${b}?`)&&$()},children:"Create"})]}),(0,m.jsx)("div",{id:"groups-list",children:e&&p.length>0&&p.map((e=>(0,m.jsx)(j,{groupID:e._id,groupName:e.name,creator:e.creator,creationDate:e.creationDate,members:e.members,admins:e.admins,chatID:e.chatId,joinRequests:e.joinRequests,onDelete:()=>{const o=p.filter((o=>o._id!==e._id));h(o)},onInvite:A},e._id)))})]})]}),(0,m.jsx)(v.Ay,{styleId:"invite-popup",onClose:()=>{w(!1)},isOpen:I,children:(0,m.jsx)(v.OI,{onInviteFriend:A})})]})})}}}]);
//# sourceMappingURL=522.e08dd29f.chunk.js.map