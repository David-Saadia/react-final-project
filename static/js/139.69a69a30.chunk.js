"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[139],{6139:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var a=t(5043),n=t(3216),o=t(6088),c=t(3944),l=t(5799),i=t(4737),r=t(3829),d=t(4518),u=t(579);function g(e){const[s,t]=(0,a.useState)([]),{user:n,loading:c}=(0,a.useContext)(o.t),[g,h]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{const e=await l.A.get(`/chats/?userId=${n.uid}&limit=20`);200===e.status&&(console.log(e.data.message),console.log(e.data.chats),h(e.data.chats))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[n]),(0,a.useEffect)((()=>{!async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&g){console.log("Attempting to pull users's chats list names/images");const e=await Promise.all(g.map((async e=>{var s;const t=e.isGroupChat?await(0,i.rb)(e.creator):await(0,i.rb)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))));console.log(t),console.log(e);let a="N/A";try{if(e.isGroupChat){const s=await l.A.get(`/groups/search/${e.group._id}`);200===s.status&&(a=s.data.group.name,console.log(a))}else a=await(0,i.qY)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))))}catch(o){console.log(o)}return(null===(s=a)||void 0===s?void 0:s.length)>10&&(a=(0,r.zo)(a).slice(0,3)),console.log(`label: ${a} avatar: ${t}`),{avatar:t,label:a}})));t(e)}}()}),[g,n]);return c?(0,u.jsx)("div",{children:"Loading..."}):(0,u.jsx)("div",{className:"docked-container",id:"chat-list-container",children:(0,u.jsx)("ul",{className:"chat-list",children:s.map(((s,t)=>(0,u.jsxs)("li",{onClick:s=>{return a=g[t]._id,console.log("opening chat",a),void e.setChatSelected(a);var a},className:"grouped chat-item",id:"chat-i",children:[(0,u.jsx)("img",{id:"chat-avatar",src:s.avatar,alt:s.label}),(0,u.jsx)(d.A,{title:s.label,designClass:"chat-title"})]},t)))})})}var h=t(2104);function m(e){const[s,t]=(0,a.useState)(""),[n,c]=(0,a.useState)(""),{message:l}=e,{user:d}=(0,a.useContext)(o.t);return(0,a.useEffect)((()=>{(async()=>{try{const e=await(0,i.rb)(l.author),s=await(0,i.qY)(l.author);t(e),c(s)}catch(e){console.log(e)}})()}),[l.author]),(0,u.jsx)("li",{className:"message grouped",children:l.author===(null===d||void 0===d?void 0:d.uid)?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"}),(0,u.jsxs)("div",{className:"message-content",children:[(0,u.jsx)("div",{className:"message-time",children:(0,r.kv)(l.timestamp)}),(0,u.jsxs)("div",{className:"chat-bubble",children:[(0,u.jsx)("div",{className:"message-username",children:(0,u.jsx)("strong",{children:n})}),(0,u.jsx)("div",{className:"message-text",children:l.content})]})]})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"message-content",children:[(0,u.jsx)("div",{className:"message-time right",children:(0,r.kv)(l.timestamp)}),(0,u.jsxs)("div",{className:"chat-bubble right",children:[(0,u.jsx)("div",{className:"message-username right",children:(0,u.jsx)("strong",{children:n})}),(0,u.jsx)("div",{className:"message-text right",children:l.content})]})]}),(0,u.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"})]})})}var v=t(9099);function x(e){const s=(0,a.useRef)(null),[t,n]=(0,a.useState)([]),[c,i]=(0,a.useState)(""),{user:r,token:d}=(0,a.useContext)(o.t),g=(0,a.useRef)(null),{chatId:x}=e,[j,p]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{n([]);try{console.log(`Attempting to pull messages for chat ${x}`);const e=await l.A.get(`/chats/${x}`);200===e.status&&(console.log(e.data.message),console.log(e.data.messages),n(e.data.messages))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[x]),(0,a.useEffect)((()=>{if(!x||!d)return;const e=(0,h.io)("http://localhost:42069");if(s.current=e,null!==e.current)return e.emit("authenticate",d),e.on("authenticated",(s=>{console.log(null===s||void 0===s?void 0:s.message),e.emit("joinChat",x)})),e.on("joinedChat",(e=>{console.log(null===e||void 0===e?void 0:e.message),p(!0)})),e.on("message",(s=>{console.log(e.id),console.log(s.content),n((e=>[...e,s]))})),e.on("error",(e=>{console.log(null===e||void 0===e?void 0:e.message)})),()=>{s.current&&(s.current.disconnect(),s.current=null),p(!1),n([])};console.log("socket is null")}),[x,d]),(0,a.useEffect)((()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[t]);const f=async()=>{if(!c.trim()||!j)return console.log("input is empty"),void(j||console.log("not joined"));s.current.emit("message",{author:r.uid,content:c,chat:x}),i("")};return(0,u.jsxs)("div",{className:"chat-room",children:[(0,u.jsx)("ul",{className:"messages",children:t.length>0&&t.map(((e,s)=>(0,u.jsx)(m,{message:e},s)))}),(0,u.jsx)("div",{ref:g}),(0,u.jsxs)("div",{className:"chat-input grouped",children:[(0,u.jsx)(v.A,{value:c,onChange:e=>i(e.target.value),prompt:"Message...",onKeyDown:e=>"Enter"===e.key&&f()}),(0,u.jsx)("button",{onClick:f,children:"Send"})]})]})}var j=t(8351),p=t(7936),f=t(4185);function b(e){let{miniView:s=!1}=e;const{chatId:t}=(0,n.g)(),[l,i]=(0,a.useState)(t||null),r=(0,n.Zp)(),{user:d}=(0,a.useContext)(o.t);(0,a.useEffect)((()=>{t!==l&&i(t)}),[t,l]),(0,a.useEffect)((()=>{d||r("/")}),[d,r]);const h=e=>{i(e),r(`/chat/${e}`)};return s?(0,u.jsx)(g,{setChatSelected:h}):(0,u.jsx)(f.A,{title:"Chat",backgroundImage:c,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,u.jsxs)("div",{className:"chat",children:[(0,u.jsx)(p.A,{}),(0,u.jsx)(j.A,{}),(0,u.jsxs)("div",{className:"page-container",id:"chat-container",children:[(0,u.jsxs)("div",{className:"grouped",children:[(0,u.jsx)(v.A,{type:"text",prompt:"Search...",styleClass:"search-bar",styleId:"chat-search"}),(0,u.jsx)("button",{children:"Search"})]}),l&&(0,u.jsx)(x,{chatId:l})]}),(0,u.jsx)(g,{setChatSelected:h})]})})}}}]);
//# sourceMappingURL=139.69a69a30.chunk.js.map