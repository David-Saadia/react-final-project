{"version":3,"file":"static/js/188.d6ee24f5.chunk.js","mappings":"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","sources":["hooks/useRequireAuth.js","pages/Profile/Profile.js","components/ChatList/ChatList.js","components/Message/Message.js","components/ChatRoom/ChatRoom.js","pages/Chat/Chat.js"],"sourcesContent":["\r\n//**This componet will be used to verify user's authentication and redirect\r\n// the user to the home page if authentication expires, instead of implementing this \r\n// redirection logic in every component, we'll just include this hook in every page component */\r\n\r\nimport { startTransition, useContext, useEffect } from \"react\";\r\nimport { userContext } from \"../UserProvider\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\n\r\n\r\nexport function useRequireAuth(){\r\n    \r\n    const {user, loading} = useContext(userContext);\r\n    \r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    \r\n    useEffect(()=>{   \r\n        const goto = (path, options={}) => {\r\n            startTransition(() => {\r\n                navigate(path, options);\r\n            });\r\n        };\r\n\r\n        if(location === \"/\")\r\n            return;\r\n\r\n        if (location === \"/home\" && !user)\r\n            goto(\"/login\");\r\n\r\n        if(loading && !user)\r\n            console.log(\"User authentication is loading...\");\r\n\r\n        if(!loading && !user){\r\n            console.log(\"User is not logged in. Redirecting to login page...\");\r\n            goto(\"/\");\r\n        }\r\n            \r\n    },[user,loading, location, navigate]);\r\n}","\r\n\r\n//Context and tools\r\n\r\nimport { useRequireAuth } from \"../../hooks/useRequireAuth\";\r\n\r\n\r\n// Components\r\nimport NavigationBar from \"../../components/base-components/NavigationBar/NavigationBar\";\r\nimport BackgroundWrapper from \"../../components/base-components/BackgroundWrapper\";\r\nimport SideMenu from \"../../components/SideMenu/SideMenu\";\r\nimport PostFeed from \"../../components/PostFeed/PostFeed\";\r\nimport bg from \"../../assets/images/background-postfeed-light.png\";\r\nimport Chat from \"../Chat/Chat\";\r\n\r\nexport default function Profile() {\r\n\r\n    useRequireAuth();\r\n\r\n    return (\r\n        <BackgroundWrapper\r\n            title=\"Profile Page\"\r\n            backgroundImage= {bg}\r\n            backgroundRepeat= \"repeat-y\"\r\n            backgroundAttachment= \"scroll\"\r\n        >\r\n\r\n            <div className =\"profile\">\r\n                <NavigationBar/>\r\n                <div className=\"page-container\" id=\"profile-page-container\">\r\n                    <SideMenu/>\r\n                    <PostFeed type=\"profile\"/>\r\n                    <Chat miniView={true}/>\r\n\r\n                </div>\r\n            </div>\r\n        </BackgroundWrapper>\r\n    )\r\n}","import { useContext, useEffect, useState } from \"react\";\r\n\r\n//Context and tools\r\nimport { userContext } from \"../../UserProvider\";\r\nimport { extractAcronym } from \"../../utils\";\r\nimport { findAvatarDB, findUserNameDB } from \"../../firebase/ReadWriteDB\";\r\nimport axiosInstance from \"../../axiosInstance\";\r\n\r\n//Components and styles\r\nimport \"./ChatList.css\"\r\nimport ScreenTitle from \"../base-components/ScreenTitle/ScreenTitle\";\r\n\r\n\r\nexport default function ChatList(props){\r\n\r\n    \r\n    const [chatThumbnails, setChatThumbnails] = useState([]);\r\n    const {user, loading, fetchImage} = useContext(userContext);\r\n    const [chatList, setChatList] = useState([]);\r\n    \r\n    useEffect(()=>{\r\n        const fetchChatList = async () => {\r\n            const limit = 20;\r\n            try{\r\n                const response = await axiosInstance.get(`/chats/?userId=${user.uid}&limit=${limit}`);\r\n                if (response.status===200){\r\n                    //DEBUG: console.log(response.data.message);\r\n                    //DEBUG: console.log(response.data.chats);\r\n                    setChatList(response.data.chats);\r\n                }\r\n            }\r\n            catch(err){\r\n                console.log(err);\r\n                console.log(err.response?.data?.message);\r\n            }\r\n        }\r\n        fetchChatList();\r\n    }, [user]);\r\n    \r\n    useEffect(() => {\r\n        const fetchChatThumbnails = async (limit=-1) => {\r\n                if(limit<0 && chatList){\r\n                    if(!user) return;\r\n                    //DEBUG: console.log(\"Attempting to pull users's chats list names/images\")\r\n                    const thumbnails = await Promise.all(chatList.map(async (chatItem) => {\r\n                        let avatar = chatItem.isGroupChat\r\n                        ? await findAvatarDB(chatItem.creator)\r\n                        : await findAvatarDB(chatItem.participants.find(member => member !== user?.uid));\r\n\r\n                        if(chatItem.group?.logo && chatItem.isGroupChat){\r\n                            console.log(\"Attempting to fetch group logo\");\r\n                            const fetchedAvatar = await fetchImage(chatItem.group?.logo, false);\r\n                            if(fetchedAvatar)\r\n                                avatar = fetchedAvatar;\r\n                        }\r\n                        else{\r\n                            if(!avatar.includes(\"static\")){\r\n                                const fetchedAvatar = await fetchImage(avatar, false);\r\n                                if(fetchedAvatar)\r\n                                    avatar = fetchedAvatar;\r\n                            }\r\n                        }\r\n\r\n                        console.log(avatar);\r\n                        console.log(chatItem);\r\n                        let label = \"N/A\"\r\n                        try{\r\n                            if(!chatItem.isGroupChat) \r\n                                label = await findUserNameDB(chatItem.participants.find(member => member !== user?.uid));\r\n                            else {\r\n                                const response = await axiosInstance.get(`/groups/search/${chatItem.group._id}`);\r\n                                if(response.status===200){\r\n                                    label = response.data.group.name;\r\n                                    console.log(label);\r\n                                }\r\n                            }\r\n                        }catch(err){\r\n                            console.log(err);\r\n                        }\r\n                        if(label?.length>10) {\r\n                            if(label.split(\" \").length>1)\r\n                                label = extractAcronym(label).slice(0,3);          \r\n                            else\r\n                                label = label.slice(0,7);\r\n                        }\r\n                        //DEBUG: console.log(`label: ${label} avatar: ${avatar}`);\r\n\r\n                        return {avatar, label};\r\n                    }));\r\n                    setChatThumbnails(thumbnails);\r\n                }\r\n        }\r\n        fetchChatThumbnails();\r\n    }, [chatList,user, fetchImage]);\r\n\r\n    const openChat =(chatIndex)=>{\r\n        console.log(\"opening chat\", chatIndex);\r\n        props.setChatSelected(chatIndex);\r\n    }\r\n    \r\n    if(loading) return <div>Loading...</div>;\r\n    \r\n    return(\r\n    <div className=\"docked-container\" id=\"chat-list-container\">\r\n        <ul className=\"chat-list\">\r\n            {chatThumbnails.map((thumbnail, index) => (\r\n                <li onClick={(e)=>openChat(chatList[index]._id)} className=\"grouped chat-item\" id=\"chat-i\" key={index}>\r\n                    <img id=\"chat-avatar\" src={thumbnail.avatar} alt={thumbnail.label} />\r\n                    <ScreenTitle title={thumbnail.label} designClass=\"chat-title\"/>\r\n                </li>\r\n            ))}\r\n        </ul>    \r\n    </div>\r\n\r\n    );\r\n}","import { useContext, useEffect, useState } from \"react\";\r\n\r\n//Context and tools\r\nimport { findAvatarDB, findUserNameDB } from \"../../firebase/ReadWriteDB\";\r\nimport { userContext } from \"../../UserProvider\";\r\nimport { timeSincePost } from \"../../utils\";\r\n\r\n//Components and styles\r\nimport \"./Message.css\";\r\n\r\nexport default function Message(props){\r\n    const [avatar, setAvatar] = useState(\"\");\r\n    const [userName, setUsername] = useState(\"\");\r\n    const {message} = props\r\n    const {user, fetchImage} = useContext(userContext);\r\n\r\n    useEffect(()=>{\r\n        const fetchAvatarAndUsername = async () => {\r\n            try{\r\n                const avatar = await findAvatarDB(message.author);\r\n                const username = await findUserNameDB(message.author);\r\n                console.log(\"avatar from message: \", avatar);\r\n                if(avatar.includes(\"static\")) \r\n                    setAvatar(avatar);\r\n                else{\r\n                    const fetchedAvatar = await fetchImage(avatar, false);\r\n\r\n                    if(fetchedAvatar)\r\n                        setAvatar(fetchedAvatar);\r\n                }\r\n                setUsername(username);\r\n            }\r\n            catch(err){\r\n                console.log(err);\r\n            }\r\n        }\r\n        fetchAvatarAndUsername();\r\n    }, [message.author, fetchImage]);\r\n\r\n\r\n    return(\r\n        <li className=\"message grouped\">\r\n            {message.author === user?.uid\r\n            ? (\r\n                <>\r\n                    <img src={avatar} alt={`message-avatar`} id=\"message-avatar\"/>\r\n                    <div className=\"message-content\">\r\n                        <div className=\"message-time\">{timeSincePost(message.timestamp)}</div>\r\n                        <div className=\"chat-bubble\">\r\n                            <div className=\"message-username\"><strong>{userName}</strong></div>\r\n                            <div className=\"message-text\">{message.content}</div>\r\n                        </div>\r\n                    </div>\r\n                </>\r\n            )\r\n            : (\r\n                <>\r\n                <div className=\"message-content\">\r\n                    <div className=\"message-time right\">{timeSincePost(message.timestamp)}</div>\r\n                    <div className=\"chat-bubble right\">\r\n                        <div className=\"message-username right\"><strong>{userName}</strong></div>\r\n                        <div className=\"message-text right\">{message.content}</div>\r\n                    </div>\r\n                </div>\r\n                <img src={avatar} alt={`message-avatar`} id=\"message-avatar\"/>\r\n                </>\r\n            )}\r\n            \r\n        </li>\r\n    );\r\n}","import { useContext, useEffect, useRef, useState } from 'react';\r\nimport {io} from 'socket.io-client';\r\nimport axiosInstance from '../../axiosInstance';\r\nimport { userContext } from '../../UserProvider';\r\nimport Message from '../Message/Message';\r\nimport Field from '../base-components/Field/Field';\r\n\r\nimport \"./ChatRoom.css\"\r\n\r\n\r\n\r\n\r\nexport default function ChatRoom(props){\r\n    \r\n    const socketRef = useRef(null);\r\n    const [messages, setMessages] = useState([]);\r\n    const [input, setInput] = useState('');\r\n    const {user, token} = useContext(userContext);\r\n    const endRef = useRef(null);\r\n    const {chatId} = props;\r\n    const [joined, setJoined] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const fetchMessage = async () => {\r\n            setMessages([]);\r\n            \r\n            try{\r\n                console.log(`Attempting to pull messages for chat ${chatId}`);\r\n                const response = await axiosInstance.get(`/chats/${chatId}`);\r\n                if (response.status===200){\r\n                    console.log(response.data.message);\r\n                    //DEBUG: console.log(response.data.messages);\r\n                    setMessages(response.data.messages);\r\n                }\r\n            }\r\n            catch(err){\r\n                console.log(err);\r\n                console.log(err.response?.data?.message);\r\n            }\r\n        }\r\n        fetchMessage();\r\n    },[chatId]);\r\n\r\n\r\n    useEffect(() => {\r\n        if(!chatId || !token) return;\r\n        const socket = io('http://localhost:42069');\r\n        socketRef.current = socket; \r\n        \r\n        if(socket.current===null) {\r\n            console.log(`socket is null`);\r\n            return;};\r\n        //console.log(`token: ${token}`);\r\n       \r\n        socket.emit('authenticate', token);\r\n\r\n        \r\n        socket.on('authenticated', (response)=>{ \r\n            console.log(response?.message);\r\n            socket.emit('joinChat', chatId);\r\n        });\r\n        \r\n        socket.on('joinedChat', (response)=>{ console.log(response?.message); setJoined(true);});\r\n\r\n        socket.on('message', (msg) => {\r\n            //DEBUG: console.log(socket.id);\r\n            //DEBUG: console.log(msg.content);\r\n            setMessages(prev=>[...prev, msg]);\r\n        });\r\n\r\n        socket.on('error', (errObj) =>{\r\n            console.log(errObj?.message);            \r\n        });\r\n\r\n        return () => {\r\n          if(socketRef.current){\r\n            socketRef.current.disconnect();\r\n            socketRef.current = null;\r\n          }\r\n          setJoined(false);\r\n          setMessages([]);\r\n        }\r\n    },[chatId, token]);\r\n\r\n    useEffect(() => {\r\n        endRef.current?.scrollIntoView({behavior: \"smooth\"});\r\n    },[messages]);\r\n\r\n    const sendMessage = async () => {\r\n        if(!input.trim() || !joined){\r\n            console.log(`input is empty`);\r\n            if(!joined)\r\n                console.log(`not joined`);\r\n            return; //Empty string.\r\n        } \r\n        socketRef.current.emit('message', {author: user.uid, content: input, chat: chatId});\r\n        setInput('');\r\n    }\r\n    return(\r\n    <div className=\"chat-room\">\r\n        <ul className=\"messages\">\r\n            {(messages.length>0) && messages.map((message,index)=>(<Message key={index} message={message}/>))}\r\n        </ul>\r\n        <div ref={endRef}></div>\r\n        <div className=\"chat-input grouped\">\r\n            <Field value={input} onChange={(e)=>setInput(e.target.value)} prompt=\"Message...\"\r\n                onKeyDown={(e)=> e.key===\"Enter\" && sendMessage()}/>\r\n            <button onClick={sendMessage}>Send</button>\r\n        </div>\r\n    </div>\r\n\r\n    );\r\n}","import {  useEffect, useState } from \"react\";\r\n//import {useContext} from \"react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\n\r\n//Context and tools\r\n//import { userContext } from \"../../UserProvider\";\r\nimport { useRequireAuth } from \"../../hooks/useRequireAuth\";\r\n\r\n//Components and styles\r\nimport bg from \"../../assets/images/background-postfeed-light.png\";\r\nimport ChatList from \"../../components/ChatList/ChatList\";\r\nimport ChatRoom from \"../../components/ChatRoom/ChatRoom\";\r\nimport SideMenu from \"../../components/SideMenu/SideMenu\";\r\nimport NavigationBar from \"../../components/base-components/NavigationBar/NavigationBar\";\r\nimport BackgroundWrapper from \"../../components/base-components/BackgroundWrapper\";\r\nimport Field from \"../../components/base-components/Field/Field\";\r\nimport \"./Chat.css\";\r\n\r\nexport default function Chat({miniView = false}){\r\n    \r\n    const {chatId} = useParams();\r\n    const [chatSelected, setChatSelected] = useState(chatId || null);\r\n    const navigation = useNavigate();\r\n    //const {user} = useContext(userContext);\r\n    useRequireAuth();\r\n\r\n    useEffect(()=>{\r\n        if(chatId!==chatSelected) setChatSelected(chatId);\r\n    },[chatId, chatSelected]);\r\n\r\n\r\n    const handleChatSelect = (id)=>{\r\n        setChatSelected(id);\r\n        navigation(`/chat/${id}`);\r\n        \r\n    }\r\n    \r\n    if( miniView)\r\n        return (<ChatList setChatSelected={handleChatSelect}/>)\r\n\r\n    return(\r\n        <BackgroundWrapper\r\n            title=\"Chat\"\r\n            backgroundImage = {bg}\r\n            backgroundPosition = \"top center\"\r\n            backgroundRepeat=\"repeat-y\"\r\n            backgroundAttachment = \"scroll\"\r\n            >\r\n\r\n            <div className=\"chat\">\r\n                <NavigationBar/>\r\n                <SideMenu/>\r\n                <div className=\"page-container\" id=\"chat-container\">\r\n                    <div className=\"grouped\">\r\n                        <Field type=\"text\" prompt=\"Search...\" styleClass=\"search-bar\" styleId=\"chat-search\"/>\r\n                        <button>Search</button>\r\n                    </div>\r\n                    {chatSelected  && (<ChatRoom chatId={chatSelected} />) }   \r\n                </div>\r\n                <ChatList setChatSelected={handleChatSelect}/>\r\n            </div>\r\n        </BackgroundWrapper>\r\n    );\r\n}"],"names":["useRequireAuth","user","loading","useContext","userContext","navigate","useNavigate","location","useLocation","useEffect","goto","path","options","arguments","length","undefined","startTransition","console","log","Profile","_jsx","BackgroundWrapper","title","backgroundImage","bg","backgroundRepeat","backgroundAttachment","children","_jsxs","className","NavigationBar","id","SideMenu","PostFeed","type","Chat","miniView","ChatList","props","chatThumbnails","setChatThumbnails","useState","fetchImage","chatList","setChatList","async","response","axiosInstance","get","uid","status","data","chats","err","_err$response","_err$response$data","message","fetchChatList","thumbnails","Promise","all","map","_chatItem$group","_label","avatar","chatItem","isGroupChat","findAvatarDB","creator","participants","find","member","group","logo","_chatItem$group2","fetchedAvatar","includes","label","_id","name","findUserNameDB","split","extractAcronym","slice","fetchChatThumbnails","thumbnail","index","onClick","e","openChat","chatIndex","setChatSelected","src","alt","ScreenTitle","designClass","Message","setAvatar","userName","setUsername","author","username","fetchAvatarAndUsername","_Fragment","timeSincePost","timestamp","content","ChatRoom","socketRef","useRef","messages","setMessages","input","setInput","token","endRef","chatId","joined","setJoined","fetchMessage","socket","io","current","emit","on","msg","prev","errObj","disconnect","_endRef$current","scrollIntoView","behavior","sendMessage","trim","chat","ref","Field","value","onChange","target","prompt","onKeyDown","key","_ref","useParams","chatSelected","navigation","handleChatSelect","backgroundPosition","styleClass","styleId"],"sourceRoot":""}