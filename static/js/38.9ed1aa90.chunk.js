"use strict";(self.webpackChunkreact_final_project=self.webpackChunkreact_final_project||[]).push([[38,139],{2525:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(5043);const n=t.p+"static/media/show-password-icon.c53d4a2c8350a35e0b0a.png",o=t.p+"static/media/hide-password-icon.bc5e1dd54b7c6292a2ea.png";var c=t(579);function l(e){const[s,t]=(0,a.useState)(!1),l="password"===e.type,i=e.value&&e.value.trim().length>0;return(0,c.jsxs)("div",{className:`form-field ${e.styleClass}`,children:[(0,c.jsx)("input",{name:e.type,type:l&&s?"text":e.type,title:e.type,value:e.value,onChange:e.onChange,required:!0}),(0,c.jsx)("span",{className:"popup_text "+(i?"has-content":""),children:e.prompt}),l&&(0,c.jsxs)("span",{onClick:()=>t((e=>!e)),children:[(0,c.jsx)("img",{className:"toggle-password",src:s?o:n,alt:"password toggle"})," "]})]})}},6139:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var a=t(5043),n=t(3216),o=t(6088),c=t(3944),l=t(5799),i=t(4737),r=t(3829),d=t(4518),u=t(579);function g(e){const[s,t]=(0,a.useState)([]),{user:n,loading:c}=(0,a.useContext)(o.t),[g,h]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{const e=await l.A.get(`/chats/?userId=${n.uid}&limit=20`);200===e.status&&(console.log(e.data.message),console.log(e.data.chats),h(e.data.chats))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[n]),(0,a.useEffect)((()=>{!async function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1)<0&&g){console.log("Attempting to pull users's chats list names/images");const e=await Promise.all(g.map((async e=>{var s;const t=e.isGroupChat?await(0,i.rb)(e.creator):await(0,i.rb)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))));console.log(t),console.log(e);let a="N/A";try{if(e.isGroupChat){const s=await l.A.get(`/groups/search/${e.group._id}`);200===s.status&&(a=s.data.group.name,console.log(a))}else a=await(0,i.qY)(e.participants.find((e=>e!==(null===n||void 0===n?void 0:n.uid))))}catch(o){console.log(o)}return(null===(s=a)||void 0===s?void 0:s.length)>10&&(a=(0,r.zo)(a).slice(0,3)),console.log(`label: ${a} avatar: ${t}`),{avatar:t,label:a}})));t(e)}}()}),[g,n]);return c?(0,u.jsx)("div",{children:"Loading..."}):(0,u.jsx)("div",{className:"docked-container",id:"chat-list-container",children:(0,u.jsx)("ul",{className:"chat-list",children:s.map(((s,t)=>(0,u.jsxs)("li",{onClick:s=>{return a=g[t]._id,console.log("opening chat",a),void e.setChatSelected(a);var a},className:"grouped chat-item",id:"chat-i",children:[(0,u.jsx)("img",{id:"chat-avatar",src:s.avatar,alt:s.label}),(0,u.jsx)(d.A,{title:s.label,designClass:"chat-title"})]},t)))})})}var h=t(2104);function m(e){const[s,t]=(0,a.useState)(""),[n,c]=(0,a.useState)(""),{message:l}=e,{user:d}=(0,a.useContext)(o.t);return(0,a.useEffect)((()=>{(async()=>{try{const e=await(0,i.rb)(l.author),s=await(0,i.qY)(l.author);t(e),c(s)}catch(e){console.log(e)}})()}),[l.author]),(0,u.jsx)("li",{className:"message grouped",children:l.author===(null===d||void 0===d?void 0:d.uid)?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"}),(0,u.jsxs)("div",{className:"message-content",children:[(0,u.jsx)("div",{className:"message-time",children:(0,r.kv)(l.timestamp)}),(0,u.jsxs)("div",{className:"chat-bubble",children:[(0,u.jsx)("div",{className:"message-username",children:(0,u.jsx)("strong",{children:n})}),(0,u.jsx)("div",{className:"message-text",children:l.content})]})]})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"message-content",children:[(0,u.jsx)("div",{className:"message-time right",children:(0,r.kv)(l.timestamp)}),(0,u.jsxs)("div",{className:"chat-bubble right",children:[(0,u.jsx)("div",{className:"message-username right",children:(0,u.jsx)("strong",{children:n})}),(0,u.jsx)("div",{className:"message-text right",children:l.content})]})]}),(0,u.jsx)("img",{src:s,alt:"message-avatar",id:"message-avatar"})]})})}var p=t(9099);function v(e){const s=(0,a.useRef)(null),[t,n]=(0,a.useState)([]),[c,i]=(0,a.useState)(""),{user:r,token:d}=(0,a.useContext)(o.t),g=(0,a.useRef)(null),{chatId:v}=e,[x,j]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{n([]);try{console.log(`Attempting to pull messages for chat ${v}`);const e=await l.A.get(`/chats/${v}`);200===e.status&&(console.log(e.data.message),console.log(e.data.messages),n(e.data.messages))}catch(t){var e,s;console.log(t),console.log(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)}})()}),[v]),(0,a.useEffect)((()=>{if(!v||!d)return;const e=(0,h.io)("http://localhost:42069");if(s.current=e,null!==e.current)return e.emit("authenticate",d),e.on("authenticated",(s=>{console.log(null===s||void 0===s?void 0:s.message),e.emit("joinChat",v)})),e.on("joinedChat",(e=>{console.log(null===e||void 0===e?void 0:e.message),j(!0)})),e.on("message",(s=>{console.log(e.id),console.log(s.content),n((e=>[...e,s]))})),e.on("error",(e=>{console.log(null===e||void 0===e?void 0:e.message)})),()=>{s.current&&(s.current.disconnect(),s.current=null),j(!1),n([])};console.log("socket is null")}),[v,d]),(0,a.useEffect)((()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[t]);const f=async()=>{if(!c.trim()||!x)return console.log("input is empty"),void(x||console.log("not joined"));s.current.emit("message",{author:r.uid,content:c,chat:v}),i("")};return(0,u.jsxs)("div",{className:"chat-room",children:[(0,u.jsx)("ul",{className:"messages",children:t.length>0&&t.map(((e,s)=>(0,u.jsx)(m,{message:e},s)))}),(0,u.jsx)("div",{ref:g}),(0,u.jsxs)("div",{className:"chat-input grouped",children:[(0,u.jsx)(p.A,{value:c,onChange:e=>i(e.target.value),prompt:"Message...",onKeyDown:e=>"Enter"===e.key&&f()}),(0,u.jsx)("button",{onClick:f,children:"Send"})]})]})}var x=t(8351),j=t(7936),f=t(4185);function b(e){let{miniView:s=!1}=e;const{chatId:t}=(0,n.g)(),[l,i]=(0,a.useState)(t||null),r=(0,n.Zp)(),{user:d}=(0,a.useContext)(o.t);(0,a.useEffect)((()=>{t!==l&&i(t)}),[t,l]),(0,a.useEffect)((()=>{d||r("/")}),[d,r]);const h=e=>{i(e),r(`/chat/${e}`)};return s?(0,u.jsx)(g,{setChatSelected:h}):(0,u.jsx)(f.A,{title:"Chat",backgroundImage:c,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,u.jsxs)("div",{className:"chat",children:[(0,u.jsx)(j.A,{}),(0,u.jsx)(x.A,{}),(0,u.jsxs)("div",{className:"page-container",id:"chat-container",children:[(0,u.jsxs)("div",{className:"grouped",children:[(0,u.jsx)(p.A,{type:"text",prompt:"Search...",styleClass:"search-bar",styleId:"chat-search"}),(0,u.jsx)("button",{children:"Search"})]}),l&&(0,u.jsx)(v,{chatId:l})]}),(0,u.jsx)(g,{setChatSelected:h})]})})}},7467:(e,s,t)=>{e.exports=t.p+"static/media/Fox_in_forest_background.e8effee3d898c5f4be05.png"},8051:(e,s,t)=>{t.r(s),t.d(s,{default:()=>y});var a=t(5043),n=t(6088),o=(t(1576),t(4185)),c=t(3944),l=t(7936),i=t(9676),r=t(8351),d=t(6139),u=t(579);function g(){const{loading:e}=(0,a.useContext)(n.t);return e?(0,u.jsx)("div",{children:"Loading..."}):(0,u.jsx)(o.A,{title:"Home",backgroundImage:c,backgroundPosition:"top center",backgroundRepeat:"repeat-y",backgroundAttachment:"scroll",children:(0,u.jsxs)("div",{className:"home",children:[(0,u.jsx)(l.A,{}),(0,u.jsxs)("div",{className:"page-container",children:[(0,u.jsx)(r.A,{}),(0,u.jsx)(i.A,{type:"all"}),(0,u.jsx)(d.default,{miniView:!0})]})]})})}var h=t(3216),m=t(7416),p=t(3936),v=t(4737),x=t(4518),j=t(2525),f=t(7467);function b(){const[e,s]=(0,a.useState)(""),[t,c]=(0,a.useState)(""),l=(0,h.Zp)(),{refreshStaleActivityVal:i}=(0,a.useContext)(n.t),r=e=>{(0,a.startTransition)((()=>{l(e)}))};return(0,u.jsx)(o.A,{title:"Login",backgroundImage:f,backgroundPosition:"center",transition:"background-image 0.5s ease-in-out",className:"center-container",children:(0,u.jsxs)("div",{className:"login auth-form-container",children:[(0,u.jsx)(x.A,{title:"Login"}),(0,u.jsx)(j.A,{type:"email",value:e,prompt:"Email",onChange:e=>s(e.target.value)}),(0,u.jsx)(j.A,{type:"password",value:t,prompt:"Password",onChange:e=>c(e.target.value)}),(0,u.jsx)("input",{className:"submit-button",onClick:async s=>{s.preventDefault();try{await(0,m.x9)(p.j,e,t),i.current&&i.current(),(0,v.$O)("/presence/",p.j.currentUser.uid),alert("Signed In Successfully")}catch(a){alert(a.message),console.log(a)}},type:"submit",value:"Sign in"}),(0,u.jsxs)("div",{className:"links-group",children:[(0,u.jsx)("button",{onClick:()=>r("/"),children:"Forgot Password"}),(0,u.jsx)("button",{onClick:()=>r("/signup"),children:"Sign Up"})]})]})})}const y=function(){const{user:e}=(0,a.useContext)(n.t);return(0,u.jsx)("div",{children:e?(0,u.jsx)(g,{}):(0,u.jsx)(b,{})})}}}]);
//# sourceMappingURL=38.9ed1aa90.chunk.js.map